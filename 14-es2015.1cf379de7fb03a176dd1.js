(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"1fcq":function(t,e,i){"use strict";i.r(e),i.d(e,"CartListPageModule",(function(){return x}));var n=i("ofXK"),r=i("3Pt+"),o=i("tyNb"),a=i("TEn/"),c=i("sYmb"),s=i("7JYj"),l=i("mrSG"),d=i("LvDl"),b=i("R0Ic"),u=i("sybk"),p=i("ul1Q"),g=i("+W2I"),h=i("7K7q"),m=i("2m4Y"),f=i("C13b"),v=i("fXoL"),y=i("otYU");function J(t,e){1&t&&(v.Kb(0,"div",10),v.Kb(1,"h4",11),v.kc(2,"\xa1Solicitud Exitosa!"),v.Jb(),v.Kb(3,"p"),v.kc(4,"Su orden ha sido procesada con \xe9xito."),v.Jb(),v.Ib(5,"hr"),v.Kb(6,"p"),v.kc(7,"Enviaremos la confirmaci\xf3n a su correo electr\xf3nico."),v.Jb(),v.Jb())}function K(t,e){1&t&&(v.Kb(0,"div",12),v.Kb(1,"h4",11),v.kc(2,"Ha ocurrido un error."),v.Jb(),v.Kb(3,"p"),v.kc(4,"No se logr\xf3 solicitar los productos."),v.Jb(),v.Ib(5,"hr"),v.Kb(6,"p"),v.kc(7,"Por favor intentar de nuevo."),v.Jb(),v.Jb())}function _(t,e){1&t&&(v.Kb(0,"div",13),v.Kb(1,"p",14),v.kc(2," No hay productos en el carrito. "),v.Jb(),v.Jb())}function j(t,e){if(1&t){const t=v.Lb();v.Kb(0,"div"),v.Kb(1,"ion-button",17),v.Sb("click",(function(){v.fc(t);const e=v.Ub().$implicit;return v.Ub().confirmDeleteEntry(e)})),v.Ib(2,"ion-icon",18),v.Jb(),v.Kb(3,"ion-button",19),v.Sb("click",(function(){v.fc(t);const e=v.Ub().$implicit;return v.Ub().editEntry(e)})),v.Ib(4,"ion-icon",20),v.Jb(),v.Jb()}}function k(t,e){if(1&t&&(v.Kb(0,"ion-item"),v.Kb(1,"ion-avatar",1),v.Ib(2,"img",15),v.Vb(3,"cloudinaryPipe"),v.Jb(),v.Kb(4,"ion-label"),v.Kb(5,"h2"),v.kc(6),v.Jb(),v.Kb(7,"ion-text"),v.Kb(8,"strong"),v.kc(9),v.Jb(),v.Jb(),v.Kb(10,"p"),v.kc(11,"Cantidad: "),v.Kb(12,"strong"),v.kc(13),v.Jb(),v.Jb(),v.Kb(14,"p"),v.kc(15,"Precio: "),v.Kb(16,"strong"),v.kc(17),v.Vb(18,"number"),v.Jb(),v.Jb(),v.Jb(),v.jc(19,j,5,0,"div",16),v.Jb()),2&t){const t=e.$implicit,i=v.Ub();v.xb(2),v.ac("src",v.Xb(3,6,t.get("product").get("imgUrls")[0],"thumbnail"),v.hc),v.xb(4),v.mc(" ",t.get("product").get("name_es")," "),v.xb(3),v.lc(t.get("product").get("presentation_es")),v.xb(4),v.lc(t.get("quantity")),v.xb(4),v.mc("\u20a1 ",v.Wb(18,9,t.price),""),v.xb(2),v.ac("ngIf","success"!==i.requestStatus)}}function I(t,e){if(1&t&&(v.Kb(0,"ion-card",21),v.Kb(1,"ion-card-content"),v.Kb(2,"div",22),v.Kb(3,"div",23),v.Kb(4,"ion-text",24),v.Kb(5,"strong"),v.kc(6,"Total: "),v.Jb(),v.Jb(),v.Jb(),v.Kb(7,"div",23),v.Kb(8,"ion-badge",25),v.Kb(9,"h3"),v.Kb(10,"strong"),v.kc(11),v.Vb(12,"number"),v.Jb(),v.Jb(),v.Jb(),v.Jb(),v.Jb(),v.Jb(),v.Jb()),2&t){const t=v.Ub();v.xb(11),v.mc("\u20a1 ",v.Wb(12,1,t.totalPrice),"")}}function C(t,e){if(1&t){const t=v.Lb();v.Kb(0,"ion-button",26),v.Sb("click",(function(){return v.fc(t),v.Ub().proceedToCheckout()})),v.kc(1," Solicitar Productos "),v.Jb()}if(2&t){const t=v.Ub();v.ac("disabled","success"===t.requestStatus)}}const O=[{path:"",component:(()=>{class t{constructor(t,e,i,n,r,o,a,c,s,l,d){this.route=t,this.router=e,this.translate=i,this.productService=n,this.toastCtrl=r,this.loadingCtrl=o,this.cartService=a,this.authService=c,this.orderService=s,this.alertCtrl=l,this.modalCtrl=d,this.daList=[],this.ionSelectInterfaceOptions={header:"Indique la cantidad"}}ngOnInit(){}ionViewWillEnter(){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.loadingCtrl.create();this.requestStatus="pending",this.loading=!0,t.present(),this.daList=yield this.cartService.GetCart(),Object(d.each)(this.daList,t=>{t.price=t.get("product").get("price_cr")*t.get("quantity")}),this.daList.length>0&&this.calculateTotal(),this.loading=!1,t.dismiss()}))}proceedToCheckout(){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({header:"Confirmar Orden",message:"\xbfDesea confirmar la solicitud?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Aceptar",handler:()=>Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.loadingCtrl.create();this.loading=!0,t.present(),this.scrollToTop(),this.prepareOrder(),this.orderService.RequestOrder(this.requestedProducts,this.totalPrice).then(e=>{this.loading=!1,t.dismiss(),console.log("Order requested!",e),this.requestStatus="success",this.cartService.EmptyCart()}).catch(e=>{t.dismiss(),console.error("Order request failed",e),this.requestStatus="failed"})}))}]});yield t.present()}))}calculateTotal(){let t=0;Object(d.each)(this.daList,e=>{t+=e.get("product").get("price_cr")*e.get("quantity")}),this.totalPrice=t}prepareOrder(){this.requestedProducts=Object(d.compact)(Object(d.map)(this.daList,t=>{if(t.get("quantity")>0)return{product_id:t.get("product").id,name:t.get("product").get("name_es"),presentation:t.get("product").get("presentation_es"),quantity:t.get("quantity"),price:t.get("product").get("price_cr")*t.get("quantity"),note:t.get("note"),brands:Object(d.map)(t.get("product").get("brands"),t=>{if(t.get("isActive"))return{id:t.id,name:t.get("name")}}),imgUrl:t.get("product").get("imgUrls")[0]}}))}scrollToTop(){this.content.scrollToTop(1500)}processCartUpdate(t,e){return Object(l.a)(this,void 0,void 0,(function*(){if(yield this.cartService.ProcessCartUpdate(t,e),0===e){const t=yield this.toastCtrl.create({message:"Se ha eliminado el producto del carrito.",duration:4e3,position:"bottom",buttons:[{icon:"close",side:"end"}]});yield t.present()}else{const t=yield this.toastCtrl.create({message:"Se ha actualizado el carrito.",duration:4e3,position:"bottom",buttons:[{icon:"close",side:"end"}]});yield t.present()}}))}editEntry(t){return Object(l.a)(this,void 0,void 0,(function*(){const e=yield this.modalCtrl.create({component:f.a,componentProps:{product:t.get("product")}});return e.onDidDismiss().then(t=>this.ionViewWillEnter()),yield e.present()}))}confirmDeleteEntry(t){return Object(l.a)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({message:"\xbfDesea eliminar el producto del carrito?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Aceptar",handler:()=>Object(l.a)(this,void 0,void 0,(function*(){const e=yield this.loadingCtrl.create();this.loading=!0,e.present(),this.processCartUpdate(t.get("product"),0).then(t=>{e.dismiss(),this.ionViewWillEnter()})}))}]});yield e.present()}))}}return t.\u0275fac=function(e){return new(e||t)(v.Hb(o.a),v.Hb(o.f),v.Hb(m.a),v.Hb(h.a),v.Hb(a.ab),v.Hb(a.T),v.Hb(p.a),v.Hb(u.a),v.Hb(g.a),v.Hb(a.a),v.Hb(a.V))},t.\u0275cmp=v.Bb({type:t,selectors:[["app-cart-list"]],viewQuery:function(t,e){var i;1&t&&v.oc(a.o,!0),2&t&&v.ec(i=v.Tb())&&(e.content=i.first)},decls:16,vars:7,consts:[["color","primary"],["slot","start"],["defaultHref","/product-list","text",""],["name","cart"],["class","animate__animated animate__fadeInDown alert alert-success ion-margin","role","alert",4,"ngIf"],["class","animate__animated animate__fadeInDown alert alert-danger ion-margin","role","alert",4,"ngIf"],["class","animate__animated animate__fadeInDown alert alert-warning ion-margin","role","alert",4,"ngIf"],[4,"ngFor","ngForOf"],["color","cream",4,"ngIf"],["class","ion-margin","size","medium","expand","full","shape","round","color","secondary",3,"disabled","click",4,"ngIf"],["role","alert",1,"animate__animated","animate__fadeInDown","alert","alert-success","ion-margin"],[1,"alert-heading"],["role","alert",1,"animate__animated","animate__fadeInDown","alert","alert-danger","ion-margin"],["role","alert",1,"animate__animated","animate__fadeInDown","alert","alert-warning","ion-margin"],[1,"mt-3"],[3,"src"],[4,"ngIf"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["color","warning",3,"click"],["name","create","slot","icon-only"],["color","cream"],[1,"row"],[1,"col"],[1,"priceTitle"],["color","success"],["size","medium","expand","full","shape","round","color","secondary",1,"ion-margin",3,"disabled","click"]],template:function(t,e){1&t&&(v.Kb(0,"ion-header"),v.Kb(1,"ion-toolbar",0),v.Kb(2,"ion-buttons",1),v.Ib(3,"ion-back-button",2),v.Jb(),v.Kb(4,"ion-title"),v.kc(5,"Carrito "),v.Ib(6,"ion-icon",3),v.Jb(),v.Jb(),v.Jb(),v.Kb(7,"ion-content"),v.jc(8,J,8,0,"div",4),v.jc(9,K,8,0,"div",5),v.jc(10,_,3,0,"div",6),v.Kb(11,"div"),v.Kb(12,"ion-list"),v.jc(13,k,20,11,"ion-item",7),v.Jb(),v.Jb(),v.jc(14,I,13,3,"ion-card",8),v.jc(15,C,2,1,"ion-button",9),v.Jb()),2&t&&(v.xb(8),v.ac("ngIf","success"===e.requestStatus),v.xb(1),v.ac("ngIf","failed"===e.requestStatus),v.xb(1),v.ac("ngIf",0===(null==e.daList?null:e.daList.length)&&!e.loading),v.xb(1),v.ac("@staggerIn",null==e.daList?null:e.daList.length),v.xb(2),v.ac("ngForOf",e.daList),v.xb(1),v.ac("ngIf",(null==e.daList?null:e.daList.length)>0),v.xb(1),v.ac("ngIf",(null==e.daList?null:e.daList.length)>0))},directives:[a.q,a.Q,a.h,a.d,a.e,a.P,a.r,a.o,n.j,a.y,n.i,a.w,a.c,a.x,a.N,a.g,a.i,a.j,a.f],pipes:[y.a,n.d],styles:[".priceTitle[_ngcontent-%COMP%]{font-size:18px;color:var(--ion-color-dark)}"],data:{animation:[Object(b.k)("staggerIn",[Object(b.j)("* => *",[Object(b.f)(":enter",Object(b.i)({opacity:0,transform:"translate3d(0,10px,0)"}),{optional:!0}),Object(b.f)(":enter",Object(b.h)("300ms",[Object(b.e)("600ms",Object(b.i)({opacity:1,transform:"translate3d(0,0,0)"}))]),{optional:!0})])])]}}),t})()}];let x=(()=>{class t{}return t.\u0275mod=v.Fb({type:t}),t.\u0275inj=v.Eb({factory:function(e){return new(e||t)},imports:[[n.b,r.d,a.R,o.h.forChild(O),c.b.forChild(),s.a]]}),t})()}}]);